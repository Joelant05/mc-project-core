(function(a,u){typeof exports=="object"&&typeof module!="undefined"?u(exports,require("path-browserify"),require("micromatch"),require("json5")):typeof define=="function"&&define.amd?define(["exports","path-browserify","micromatch","json5"],u):(a=typeof globalThis!="undefined"?globalThis:a||self,u(a.MCProjectCore={},a.pathBrowserify,a.micromatch,a.json5))})(this,function(a,u,A,b){"use strict";var y,F=new Uint8Array(16);function M(){if(!y&&(y=typeof crypto!="undefined"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||typeof msCrypto!="undefined"&&typeof msCrypto.getRandomValues=="function"&&msCrypto.getRandomValues.bind(msCrypto),!y))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return y(F)}var E=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function R(n){return typeof n=="string"&&E.test(n)}for(var r=[],g=0;g<256;++g)r.push((g+256).toString(16).substr(1));function S(n){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,t=(r[n[e+0]]+r[n[e+1]]+r[n[e+2]]+r[n[e+3]]+"-"+r[n[e+4]]+r[n[e+5]]+"-"+r[n[e+6]]+r[n[e+7]]+"-"+r[n[e+8]]+r[n[e+9]]+"-"+r[n[e+10]]+r[n[e+11]]+r[n[e+12]]+r[n[e+13]]+r[n[e+14]]+r[n[e+15]]).toLowerCase();if(!R(t))throw TypeError("Stringified UUID is invalid");return t}function V(n,e,t){n=n||{};var s=n.random||(n.rng||M)();if(s[6]=s[6]&15|64,s[8]=s[8]&63|128,e){t=t||0;for(var o=0;o<16;++o)e[t+o]=s[o];return e}return S(s)}class W{constructor(e){this.projectConfig=e,this.packTypes=[],this.extensionPackTypes=new Map}get all(){return[...this.packTypes].concat(...Array.from(this.extensionPackTypes.values()))}getFromId(e){return this.all.find(t=>t.id===e)}get(e){const t=this.projectConfig.getAvailablePacks();for(const s in t)if(e.startsWith(t[s]))return this.getFromId(s)}getId(e){var t,s;return(s=(t=this.get(e))==null?void 0:t.id)!=null?s:"unknown"}addExtensionPackType(e){const t=V();return this.extensionPackTypes.set(t,e),{dispose:()=>this.extensionPackTypes.delete(t)}}}class I{constructor(e){this.projectConfig=e,this.pluginFileTypes=new Set,this.fileTypes=[]}setProjectConfig(e){this.projectConfig=e}addPluginFileType(e){return this.pluginFileTypes.add(e),{dispose:()=>this.pluginFileTypes.delete(e)}}getPluginFileTypes(){return[...this.pluginFileTypes.values()]}setPluginFileTypes(e=[]){this.pluginFileTypes.clear(),e.forEach(t=>this.pluginFileTypes.add(t))}get(e,t){var o,h,f,c,p,l,d,T,k,P,v,j,C;const s=e?u.extname(e):null;for(const i of this.fileTypes){if(t!==void 0&&t===i.id)return i;if(!e)continue;const x=((o=i.detect)==null?void 0:o.packType)===void 0?[]:Array.isArray((h=i.detect)==null?void 0:h.packType)?(f=i.detect)==null?void 0:f.packType:[(c=i.detect)==null?void 0:c.packType],w=(p=i.detect)==null?void 0:p.fileExtensions,q=!!((l=i.detect)==null?void 0:l.scope),U=Array.isArray((d=i.detect)==null?void 0:d.scope)?(T=i.detect)==null?void 0:T.scope:[(k=i.detect)==null?void 0:k.scope],O=!!((P=i.detect)==null?void 0:P.matcher),_=Array.isArray((v=i.detect)==null?void 0:v.matcher)?(j=i.detect)==null?void 0:j.matcher:[(C=i.detect)==null?void 0:C.matcher];if(!(w&&s&&!w.includes(s)))if(q){if(this.prefixMatchers(x,U).some(G=>e.startsWith(G)))return i}else if(O){if(A.isMatch(e,this.prefixMatchers(x,_)))return i}else throw console.log(i),new Error('Invalid file definition, no "detect" properties')}}prefixMatchers(e,t){if(!this.projectConfig)return[];if(e.length===0)return t.map(o=>this.projectConfig.resolvePackPath(void 0,o));const s=[];for(const o of e)for(const h of t)s.push(this.projectConfig.resolvePackPath(o,h));return s}getIds(){const e=[];for(const t of this.fileTypes)e.push(t.id);return e}async guessFolder(e){var f;const t=c=>{let p=Array.isArray(c)?c[0]:c;return p.endsWith("/")||(p+="/"),p},s=`.${e.name.split(".").pop()}`;for(const{detect:c={}}of this.fileTypes)if(!!c.scope&&((f=c.fileExtensions)==null?void 0:f.includes(s)))return t(c.scope);if(!e.name.endsWith(".json"))return null;const o=await e.getFile();let h;try{h=b.parse(await o.text())}catch{return null}for(const{type:c,detect:p}of this.fileTypes){if(typeof c=="string"&&c!=="json")continue;const{scope:l,fileContent:d}=p!=null?p:{};if(!(!l||!d))return t(l)}return null}getId(e){var t,s;return(s=(t=this.get(e))==null?void 0:t.id)!=null?s:"unknown"}isJsonFile(e){var s,o;const t=(o=(s=this.get(e))==null?void 0:s.meta)==null?void 0:o.language;return t?t==="json":e.endsWith(".json")}getMonacoSchemaEntries(){return this.fileTypes.map(({detect:e={},schema:t})=>{if(!e.matcher)return null;const s=(e==null?void 0:e.packType)===void 0?[]:Array.isArray(e==null?void 0:e.packType)?e==null?void 0:e.packType:[e==null?void 0:e.packType];return{fileMatch:this.prefixMatchers(s,Array.isArray(e.matcher)?[...e.matcher]:[e.matcher]),uri:t}}).filter(e=>e!==null).flat()}}const m={behaviorPack:"./BP",resourcePack:"./RP",skinPack:"./SP",worldTemplate:"./WT"};class ${constructor(e){this.basePath=e,this.data={}}async refreshConfig(){try{this.data=await this.readConfig()}catch{this.data={}}}async setup(){await this.refreshConfig()}get(){return this.data}getPackRoot(e){var t,s;return(s=(t=this.data.packs)==null?void 0:t[e])!=null?s:m[e]}resolvePackPath(e,t){return!t&&!e?this.basePath:!e&&t?u.join(this.basePath,t):!t&&e?u.resolve(this.basePath,`${this.getPackRoot(e)}`):u.resolve(this.basePath,`${this.getPackRoot(e)}/${t}`)}getAvailablePackPaths(){var t;const e=[];for(const s of Object.keys((t=this.data.packs)!=null?t:{}))e.push(this.resolvePackPath(s));return e}getAvailablePacks(){var t;const e={};for(const s in(t=this.data.packs)!=null?t:{})e[s]=this.resolvePackPath(s);return e}async save(){await this.writeConfig(this.data)}}a.FileType=I,a.PackType=W,a.ProjectConfig=$,a.defaultPackPaths=m,Object.defineProperty(a,"__esModule",{value:!0}),a[Symbol.toStringTag]="Module"});
