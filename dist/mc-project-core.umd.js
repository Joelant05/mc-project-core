(function(o,h){typeof exports=="object"&&typeof module!="undefined"?h(exports,require("path-browserify"),require("json5")):typeof define=="function"&&define.amd?define(["exports","path-browserify","json5"],h):(o=typeof globalThis!="undefined"?globalThis:o||self,h(o.MCProjectCore={},o.pathBrowserify,o.json5))})(this,function(o,h,m){"use strict";function F(l){return l&&typeof l=="object"&&"default"in l?l:{default:l}}var b=F(m);const d={behaviorPack:"./BP",resourcePack:"./RP",skinPack:"./SP",worldTemplate:"./WT"};class x{constructor(e){this.basePath=e,this.data={}}async refreshConfig(){try{this.data=await this.readConfig()}catch{this.data={}}}async setup(){await this.refreshConfig()}get(){return this.data}getPackRoot(e){var t,s;return(s=(t=this.data.packs)==null?void 0:t[e])!=null?s:d[e]}resolvePackPath(e,t){return!t&&!e?this.basePath:!e&&t?h.join(this.basePath,t):!t&&e?h.resolve(this.basePath,`${this.getPackRoot(e)}`):h.resolve(this.basePath,`${this.getPackRoot(e)}/${t}`)}getAvailablePackPaths(){var t;const e=[];for(const s of Object.keys((t=this.data.packs)!=null?t:{}))e.push(this.resolvePackPath(s));return e}getAvailablePacks(){var t;const e={};for(const s in(t=this.data.packs)!=null?t:{})e[s]=this.resolvePackPath(s);return e}async save(){await this.writeConfig(this.data)}}class w{constructor(e){this.projectConfig=e,this.packTypes=[],this.extensionPackTypes=new Set}setProjectConfig(e){this.projectConfig=e}get all(){return this.packTypes.concat(...Array.from(this.extensionPackTypes.values()))}getFromId(e){return this.all.find(t=>t.id===e)}get(e){var s,n;const t=(n=(s=this.projectConfig)==null?void 0:s.getAvailablePacks())!=null?n:d;for(const c in t)if(e.startsWith(t[c]))return this.getFromId(c)}getId(e){var t,s;return(s=(t=this.get(e))==null?void 0:t.id)!=null?s:"unknown"}addExtensionPackType(e){return this.extensionPackTypes.add(e),{dispose:()=>this.extensionPackTypes.delete(e)}}}class A{constructor(e,t){this.projectConfig=e,this.isMatch=t,this.pluginFileTypes=new Set,this.fileTypes=[]}get all(){return this.fileTypes.concat([...this.pluginFileTypes.values()])}setProjectConfig(e){this.projectConfig=e}addPluginFileType(e){return this.pluginFileTypes.add(e),{dispose:()=>this.pluginFileTypes.delete(e)}}getPluginFileTypes(){return[...this.pluginFileTypes.values()]}setPluginFileTypes(e=[]){this.pluginFileTypes.clear(),e.forEach(t=>this.pluginFileTypes.add(t))}get(e,t){var n,c,u,r,a,p,f,g,y,P,k,T,j;const s=e?h.extname(e):null;for(const i of this.all){if(t!==void 0&&t===i.id)return i;if(!e)continue;const v=((n=i.detect)==null?void 0:n.packType)===void 0?[]:Array.isArray((c=i.detect)==null?void 0:c.packType)?(u=i.detect)==null?void 0:u.packType:[(r=i.detect)==null?void 0:r.packType],C=(a=i.detect)==null?void 0:a.fileExtensions,M=!!((p=i.detect)==null?void 0:p.scope),S=Array.isArray((f=i.detect)==null?void 0:f.scope)?(g=i.detect)==null?void 0:g.scope:[(y=i.detect)==null?void 0:y.scope],E=!!((P=i.detect)==null?void 0:P.matcher),W=Array.isArray((k=i.detect)==null?void 0:k.matcher)?(T=i.detect)==null?void 0:T.matcher:[(j=i.detect)==null?void 0:j.matcher];if(!(C&&s&&!C.includes(s)))if(M){if(this.prefixMatchers(v,S).some(_=>e.startsWith(_)))return i}else if(E){if(this.isMatch(e,this.prefixMatchers(v,W)))return i}else throw console.log(i),new Error('Invalid file definition, no "detect" properties')}}prefixMatchers(e,t){if(!this.projectConfig)return[];if(e.length===0)return t.map(n=>this.projectConfig.resolvePackPath(void 0,n));const s=[];for(const n of e)for(const c of t)s.push(this.projectConfig.resolvePackPath(n,c));return s}getIds(){const e=[];for(const t of this.all)e.push(t.id);return e}async guessFolder(e){var u;const t=r=>{let a=Array.isArray(r)?r[0]:r;return a.endsWith("/")||(a+="/"),a},s=`.${e.name.split(".").pop()}`;for(const{detect:r={}}of this.all)if(!!r.scope&&((u=r.fileExtensions)==null?void 0:u.includes(s)))return t(r.scope);if(!e.name.endsWith(".json"))return null;const n=await e.getFile();let c;try{c=b.default.parse(await n.text())}catch{return null}for(const{type:r,detect:a}of this.all){if(typeof r=="string"&&r!=="json")continue;const{scope:p,fileContent:f}=a!=null?a:{};if(!(!p||!f))return t(p)}return null}getId(e){var t,s;return(s=(t=this.get(e))==null?void 0:t.id)!=null?s:"unknown"}isJsonFile(e){var s,n;const t=(n=(s=this.get(e))==null?void 0:s.meta)==null?void 0:n.language;return t?t==="json":e.endsWith(".json")}}o.FileType=A,o.PackType=w,o.ProjectConfig=x,o.defaultPackPaths=d,Object.defineProperty(o,"__esModule",{value:!0}),o[Symbol.toStringTag]="Module"});
