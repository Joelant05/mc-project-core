(function(a,p){typeof exports=="object"&&typeof module!="undefined"?p(exports,require("path-browserify"),require("micromatch"),require("json5")):typeof define=="function"&&define.amd?define(["exports","path-browserify","micromatch","json5"],p):(a=typeof globalThis!="undefined"?globalThis:a||self,p(a.MCProjectCore={},a.pathBrowserify,a.micromatch,a.json5))})(this,function(a,p,b,F){"use strict";function A(n){return n&&typeof n=="object"&&"default"in n?n:{default:n}}var R=A(F),l,E=new Uint8Array(16);function M(){if(!l&&(l=typeof crypto!="undefined"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||typeof msCrypto!="undefined"&&typeof msCrypto.getRandomValues=="function"&&msCrypto.getRandomValues.bind(msCrypto),!l))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return l(E)}var S=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function V(n){return typeof n=="string"&&S.test(n)}for(var o=[],y=0;y<256;++y)o.push((y+256).toString(16).substr(1));function W(n){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,e=(o[n[t+0]]+o[n[t+1]]+o[n[t+2]]+o[n[t+3]]+"-"+o[n[t+4]]+o[n[t+5]]+"-"+o[n[t+6]]+o[n[t+7]]+"-"+o[n[t+8]]+o[n[t+9]]+"-"+o[n[t+10]]+o[n[t+11]]+o[n[t+12]]+o[n[t+13]]+o[n[t+14]]+o[n[t+15]]).toLowerCase();if(!V(e))throw TypeError("Stringified UUID is invalid");return e}function I(n,t,e){n=n||{};var s=n.random||(n.rng||M)();if(s[6]=s[6]&15|64,s[8]=s[8]&63|128,t){e=e||0;for(var r=0;r<16;++r)t[e+r]=s[r];return t}return W(s)}class _{constructor(t){this.projectConfig=t,this.packTypes=[],this.extensionPackTypes=new Map}get all(){return this.packTypes.concat(...Array.from(this.extensionPackTypes.values()))}getFromId(t){return this.all.find(e=>e.id===t)}get(t){const e=this.projectConfig.getAvailablePacks();for(const s in e)if(t.startsWith(e[s]))return this.getFromId(s)}getId(t){var e,s;return(s=(e=this.get(t))==null?void 0:e.id)!=null?s:"unknown"}addExtensionPackType(t){const e=I();return this.extensionPackTypes.set(e,t),{dispose:()=>this.extensionPackTypes.delete(e)}}}class ${constructor(t){this.projectConfig=t,this.pluginFileTypes=new Set,this.fileTypes=[]}get all(){return this.fileTypes.concat([...this.pluginFileTypes.values()])}setProjectConfig(t){this.projectConfig=t}addPluginFileType(t){return this.pluginFileTypes.add(t),{dispose:()=>this.pluginFileTypes.delete(t)}}getPluginFileTypes(){return[...this.pluginFileTypes.values()]}setPluginFileTypes(t=[]){this.pluginFileTypes.clear(),t.forEach(e=>this.pluginFileTypes.add(e))}get(t,e){var r,f,d,c,u,h,g,P,T,k,v,j,C;const s=t?p.extname(t):null;for(const i of this.all){if(e!==void 0&&e===i.id)return i;if(!t)continue;const x=((r=i.detect)==null?void 0:r.packType)===void 0?[]:Array.isArray((f=i.detect)==null?void 0:f.packType)?(d=i.detect)==null?void 0:d.packType:[(c=i.detect)==null?void 0:c.packType],w=(u=i.detect)==null?void 0:u.fileExtensions,U=!!((h=i.detect)==null?void 0:h.scope),L=Array.isArray((g=i.detect)==null?void 0:g.scope)?(P=i.detect)==null?void 0:P.scope:[(T=i.detect)==null?void 0:T.scope],O=!!((k=i.detect)==null?void 0:k.matcher),D=Array.isArray((v=i.detect)==null?void 0:v.matcher)?(j=i.detect)==null?void 0:j.matcher:[(C=i.detect)==null?void 0:C.matcher];if(!(w&&s&&!w.includes(s)))if(U){if(this.prefixMatchers(x,L).some(G=>t.startsWith(G)))return i}else if(O){if(b.isMatch(t,this.prefixMatchers(x,D)))return i}else throw console.log(i),new Error('Invalid file definition, no "detect" properties')}}prefixMatchers(t,e){if(!this.projectConfig)return[];if(t.length===0)return e.map(r=>this.projectConfig.resolvePackPath(void 0,r));const s=[];for(const r of t)for(const f of e)s.push(this.projectConfig.resolvePackPath(r,f));return s}getIds(){const t=[];for(const e of this.all)t.push(e.id);return t}async guessFolder(t){var d;const e=c=>{let u=Array.isArray(c)?c[0]:c;return u.endsWith("/")||(u+="/"),u},s=`.${t.name.split(".").pop()}`;for(const{detect:c={}}of this.all)if(!!c.scope&&((d=c.fileExtensions)==null?void 0:d.includes(s)))return e(c.scope);if(!t.name.endsWith(".json"))return null;const r=await t.getFile();let f;try{f=R.default.parse(await r.text())}catch{return null}for(const{type:c,detect:u}of this.all){if(typeof c=="string"&&c!=="json")continue;const{scope:h,fileContent:g}=u!=null?u:{};if(!(!h||!g))return e(h)}return null}getId(t){var e,s;return(s=(e=this.get(t))==null?void 0:e.id)!=null?s:"unknown"}isJsonFile(t){var s,r;const e=(r=(s=this.get(t))==null?void 0:s.meta)==null?void 0:r.language;return e?e==="json":t.endsWith(".json")}}const m={behaviorPack:"./BP",resourcePack:"./RP",skinPack:"./SP",worldTemplate:"./WT"};class q{constructor(t){this.basePath=t,this.data={}}async refreshConfig(){try{this.data=await this.readConfig()}catch{this.data={}}}async setup(){await this.refreshConfig()}get(){return this.data}getPackRoot(t){var e,s;return(s=(e=this.data.packs)==null?void 0:e[t])!=null?s:m[t]}resolvePackPath(t,e){return!e&&!t?this.basePath:!t&&e?p.join(this.basePath,e):!e&&t?p.resolve(this.basePath,`${this.getPackRoot(t)}`):p.resolve(this.basePath,`${this.getPackRoot(t)}/${e}`)}getAvailablePackPaths(){var e;const t=[];for(const s of Object.keys((e=this.data.packs)!=null?e:{}))t.push(this.resolvePackPath(s));return t}getAvailablePacks(){var e;const t={};for(const s in(e=this.data.packs)!=null?e:{})t[s]=this.resolvePackPath(s);return t}async save(){await this.writeConfig(this.data)}}a.FileType=$,a.PackType=_,a.ProjectConfig=q,a.defaultPackPaths=m,Object.defineProperty(a,"__esModule",{value:!0}),a[Symbol.toStringTag]="Module"});
