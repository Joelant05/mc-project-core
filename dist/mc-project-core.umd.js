(function(g,m){typeof exports=="object"&&typeof module!="undefined"?m(exports,require("micromatch"),require("json5")):typeof define=="function"&&define.amd?define(["exports","micromatch","json5"],m):(g=typeof globalThis!="undefined"?globalThis:g||self,m(g.MCProjectCore={},g.micromatch,g.json5))})(this,function(g,m,j){"use strict";class S{constructor(e){this.projectConfig=e}}function v(f){if(typeof f!="string")throw new TypeError("Path must be a string. Received "+JSON.stringify(f))}function T(f,e){for(var r="",t=0,i=-1,o=0,n,s=0;s<=f.length;++s){if(s<f.length)n=f.charCodeAt(s);else{if(n===47)break;n=47}if(n===47){if(!(i===s-1||o===1))if(i!==s-1&&o===2){if(r.length<2||t!==2||r.charCodeAt(r.length-1)!==46||r.charCodeAt(r.length-2)!==46){if(r.length>2){var a=r.lastIndexOf("/");if(a!==r.length-1){a===-1?(r="",t=0):(r=r.slice(0,a),t=r.length-1-r.lastIndexOf("/")),i=s,o=0;continue}}else if(r.length===2||r.length===1){r="",t=0,i=s,o=0;continue}}e&&(r.length>0?r+="/..":r="..",t=2)}else r.length>0?r+="/"+f.slice(i+1,s):r=f.slice(i+1,s),t=s-i-1;i=s,o=0}else n===46&&o!==-1?++o:o=-1}return r}function F(f,e){var r=e.dir||e.root,t=e.base||(e.name||"")+(e.ext||"");return r?r===e.root?r+t:r+f+t:t}var y={resolve:function(){for(var e="",r=!1,t,i=arguments.length-1;i>=-1&&!r;i--){var o;i>=0?o=arguments[i]:(t===void 0&&(t=process.cwd()),o=t),v(o),o.length!==0&&(e=o+"/"+e,r=o.charCodeAt(0)===47)}return e=T(e,!r),r?e.length>0?"/"+e:"/":e.length>0?e:"."},normalize:function(e){if(v(e),e.length===0)return".";var r=e.charCodeAt(0)===47,t=e.charCodeAt(e.length-1)===47;return e=T(e,!r),e.length===0&&!r&&(e="."),e.length>0&&t&&(e+="/"),r?"/"+e:e},isAbsolute:function(e){return v(e),e.length>0&&e.charCodeAt(0)===47},join:function(){if(arguments.length===0)return".";for(var e,r=0;r<arguments.length;++r){var t=arguments[r];v(t),t.length>0&&(e===void 0?e=t:e+="/"+t)}return e===void 0?".":y.normalize(e)},relative:function(e,r){if(v(e),v(r),e===r||(e=y.resolve(e),r=y.resolve(r),e===r))return"";for(var t=1;t<e.length&&e.charCodeAt(t)===47;++t);for(var i=e.length,o=i-t,n=1;n<r.length&&r.charCodeAt(n)===47;++n);for(var s=r.length,a=s-n,h=o<a?o:a,c=-1,l=0;l<=h;++l){if(l===h){if(a>h){if(r.charCodeAt(n+l)===47)return r.slice(n+l+1);if(l===0)return r.slice(n+l)}else o>h&&(e.charCodeAt(t+l)===47?c=l:l===0&&(c=0));break}var p=e.charCodeAt(t+l),C=r.charCodeAt(n+l);if(p!==C)break;p===47&&(c=l)}var d="";for(l=t+c+1;l<=i;++l)(l===i||e.charCodeAt(l)===47)&&(d.length===0?d+="..":d+="/..");return d.length>0?d+r.slice(n+c):(n+=c,r.charCodeAt(n)===47&&++n,r.slice(n))},_makeLong:function(e){return e},dirname:function(e){if(v(e),e.length===0)return".";for(var r=e.charCodeAt(0),t=r===47,i=-1,o=!0,n=e.length-1;n>=1;--n)if(r=e.charCodeAt(n),r===47){if(!o){i=n;break}}else o=!1;return i===-1?t?"/":".":t&&i===1?"//":e.slice(0,i)},basename:function(e,r){if(r!==void 0&&typeof r!="string")throw new TypeError('"ext" argument must be a string');v(e);var t=0,i=-1,o=!0,n;if(r!==void 0&&r.length>0&&r.length<=e.length){if(r.length===e.length&&r===e)return"";var s=r.length-1,a=-1;for(n=e.length-1;n>=0;--n){var h=e.charCodeAt(n);if(h===47){if(!o){t=n+1;break}}else a===-1&&(o=!1,a=n+1),s>=0&&(h===r.charCodeAt(s)?--s==-1&&(i=n):(s=-1,i=a))}return t===i?i=a:i===-1&&(i=e.length),e.slice(t,i)}else{for(n=e.length-1;n>=0;--n)if(e.charCodeAt(n)===47){if(!o){t=n+1;break}}else i===-1&&(o=!1,i=n+1);return i===-1?"":e.slice(t,i)}},extname:function(e){v(e);for(var r=-1,t=0,i=-1,o=!0,n=0,s=e.length-1;s>=0;--s){var a=e.charCodeAt(s);if(a===47){if(!o){t=s+1;break}continue}i===-1&&(o=!1,i=s+1),a===46?r===-1?r=s:n!==1&&(n=1):r!==-1&&(n=-1)}return r===-1||i===-1||n===0||n===1&&r===i-1&&r===t+1?"":e.slice(r,i)},format:function(e){if(e===null||typeof e!="object")throw new TypeError('The "pathObject" argument must be of type Object. Received type '+typeof e);return F("/",e)},parse:function(e){v(e);var r={root:"",dir:"",base:"",ext:"",name:""};if(e.length===0)return r;var t=e.charCodeAt(0),i=t===47,o;i?(r.root="/",o=1):o=0;for(var n=-1,s=0,a=-1,h=!0,c=e.length-1,l=0;c>=o;--c){if(t=e.charCodeAt(c),t===47){if(!h){s=c+1;break}continue}a===-1&&(h=!1,a=c+1),t===46?n===-1?n=c:l!==1&&(l=1):n!==-1&&(l=-1)}return n===-1||a===-1||l===0||l===1&&n===a-1&&n===s+1?a!==-1&&(s===0&&i?r.base=r.name=e.slice(1,a):r.base=r.name=e.slice(s,a)):(s===0&&i?(r.name=e.slice(1,n),r.base=e.slice(1,a)):(r.name=e.slice(s,n),r.base=e.slice(s,a)),r.ext=e.slice(n,a)),s>0?r.dir=e.slice(0,s-1):i&&(r.dir="/"),r},sep:"/",delimiter:":",win32:null,posix:null};y.posix=y;var A=y;class M{constructor(e){this.projectConfig=e,this.pluginFileTypes=new Set,this.fileTypes=[]}setProjectConfig(e){this.projectConfig=e}addPluginFileType(e){return this.pluginFileTypes.add(e),{dispose:()=>this.pluginFileTypes.delete(e)}}getPluginFileTypes(){return[...this.pluginFileTypes.values()]}setPluginFileTypes(e=[]){this.pluginFileTypes.clear(),e.forEach(r=>this.pluginFileTypes.add(r))}get(e,r){var i,o,n,s,a,h,c,l,p,C,d,k,P;const t=e?A.extname(e):null;for(const u of this.fileTypes){if(r!==void 0&&r===u.id)return u;if(!e)continue;const b=((i=u.detect)==null?void 0:i.packType)===void 0?[]:Array.isArray((o=u.detect)==null?void 0:o.packType)?(n=u.detect)==null?void 0:n.packType:[(s=u.detect)==null?void 0:s.packType],w=(a=u.detect)==null?void 0:a.fileExtensions,R=!!((h=u.detect)==null?void 0:h.scope),L=Array.isArray((c=u.detect)==null?void 0:c.scope)?(l=u.detect)==null?void 0:l.scope:[(p=u.detect)==null?void 0:p.scope],W=!!((C=u.detect)==null?void 0:C.matcher),_=Array.isArray((d=u.detect)==null?void 0:d.matcher)?(k=u.detect)==null?void 0:k.matcher:[(P=u.detect)==null?void 0:P.matcher];if(!(w&&t&&!w.includes(t)))if(R){if(this.prefixMatchers(b,L).some(z=>e.startsWith(z)))return u}else if(W){if(m.isMatch(e,this.prefixMatchers(b,_)))return u}else throw console.log(u),new Error('Invalid file definition, no "detect" properties')}}prefixMatchers(e,r){if(!this.projectConfig)return[];if(e.length===0)return r.map(i=>this.projectConfig.resolvePackPath(void 0,i));const t=[];for(const i of e)for(const o of r)t.push(this.projectConfig.resolvePackPath(i,o));return t}getIds(){const e=[];for(const r of this.fileTypes)e.push(r.id);return e}async guessFolder(e){var n;const r=s=>{let a=Array.isArray(s)?s[0]:s;return a.endsWith("/")||(a+="/"),a},t=`.${e.name.split(".").pop()}`;for(const{detect:s={}}of this.fileTypes)if(!!s.scope&&((n=s.fileExtensions)==null?void 0:n.includes(t)))return r(s.scope);if(!e.name.endsWith(".json"))return null;const i=await e.getFile();let o;try{o=j.parse(await i.text())}catch{return null}for(const{type:s,detect:a}of this.fileTypes){if(typeof s=="string"&&s!=="json")continue;const{scope:h,fileContent:c}=a!=null?a:{};if(!(!h||!c))return r(h)}return null}getId(e){var r,t;return(t=(r=this.get(e))==null?void 0:r.id)!=null?t:"unknown"}isJsonFile(e){var t,i;const r=(i=(t=this.get(e))==null?void 0:t.meta)==null?void 0:i.language;return r?r==="json":e.endsWith(".json")}getMonacoSchemaEntries(){return this.fileTypes.map(({detect:e={},schema:r})=>{if(!e.matcher)return null;const t=(e==null?void 0:e.packType)===void 0?[]:Array.isArray(e==null?void 0:e.packType)?e==null?void 0:e.packType:[e==null?void 0:e.packType];return{fileMatch:this.prefixMatchers(t,Array.isArray(e.matcher)?[...e.matcher]:[e.matcher]),uri:r}}).filter(e=>e!==null).flat()}}const E={behaviorPack:"./BP",resourcePack:"./RP",skinPack:"./SP",worldTemplate:"./WT"};class x{constructor(e){this.basePath=e,this.data={}}async refreshConfig(){try{this.data=await this.readConfig()}catch{this.data={}}}async setup(){await this.refreshConfig()}get(){return this.data}getPackRoot(e){var r,t;return(t=(r=this.data.packs)==null?void 0:r[e])!=null?t:E[e]}resolvePackPath(e,r){return!r&&!e?this.basePath:!e&&r?A.join(this.basePath,r):!r&&e?A.resolve(this.basePath,`${this.getPackRoot(e)}`):A.resolve(this.basePath,`${this.getPackRoot(e)}/${r}`)}getAvailablePackPaths(){var r;const e=[];for(const t of Object.keys((r=this.data.packs)!=null?r:{}))e.push(this.resolvePackPath(t));return e}async save(){await this.writeConfig(this.data)}}g.FileType=M,g.PackType=S,g.ProjectConfig=x,Object.defineProperty(g,"__esModule",{value:!0}),g[Symbol.toStringTag]="Module"});
